<html>
<body>

    <table>
        <tr>
            <td>
                <canvas id = "tricanvas" width = "600" height = "600" style="border:1px solid #000000;">
                </canvas>
            </td>
            <td>
                <table>
                    <tr>
                        <td>
                        <button type = "button" onclick = "callChooseX()">Select X points</button>
                        </td>
                    </tr>

                    <tr>
                        <td>
                        <button type = "button" onclick = "callChooseY()">Select Y points</button>
                        </td>
					</tr>
					
					<tr>
						<td>
							<button type = "button" onclick = "drawLineX()">Draw Line X</button>
						</td>
					</tr>

					<tr>
						<td>
							<button type = "button" onclick = "drawLineY()">Draw Line Y</button>
						</td>
					</tr>

					<tr>
						<td>
							<button type = "button" onclick = "matchPoints()">Match Points</button>
						</td>
					</tr>
                </table>
            </td>
        </tr>

    </table>


<script>
	let canvas = document.getElementById('tricanvas');
	let ctx = canvas.getContext("2d"); //For drawing

	//Need this to disable that annoying menu that pops up on right click
	canvas.addEventListener("contextmenu", function(e){ e.stopPropagation(); e.preventDefault(); return false; }); 

	let xpoints = [];
    let ypoints = [];
    let selectingX = true;

    function callChooseX() {
        selectingX = true;
    }
    function callChooseY() {
        selectingX = false;
    }

	/**
	 * Return mouse position with respect to the canvas after
	 * doing a coordinate transformation from global mouse coordinate
	*/
	function getMousePos(canvas, evt) {
		let rect = canvas.getBoundingClientRect();
		return {
			X: evt.clientX - rect.left,
			Y: evt.clientY - rect.top
		};
	}

	function repaint() {
		const dW = 5;
		const W = canvas.width;
		const H = canvas.height;
		ctx.clearRect(0, 0, W, H); // Puts white over everything to clear it

		ctx.fillStyle = "red";
		xpoints.forEach(function(p) {
			ctx.fillRect(p[0]-dW, p[1]-dW, dW*2+1, dW*2+1);
		});
        ctx.stroke();

        ctx.fillStyle = "blue";
		ypoints.forEach(function(p) {
			ctx.fillRect(p[0]-dW, p[1]-dW, dW*2+1, dW*2+1);
		});
        ctx.stroke();
		
	}

	function drawLineX(){
		//Draw segment lengths for x
		for (var i = 1; i < xpoints.length; i ++) {//i+=2 because each set of points is two elements long
			X0 = xpoints[i-1][0]; 
			Y0 = xpoints[i-1][1];
			X1 = xpoints[i][0];
			Y1 = xpoints[i][1];

			ctx.fillStyle = "black";
			ctx.beginPath();
			ctx.moveTo(X0, Y0);
			ctx.lineTo(X1, Y1);
			ctx.stroke();        
		}
	}

	function drawLineY(){
		//Draw line segments for y
		for(var i = 1; i < ypoints.length; i ++){
			X0 = ypoints[i-1][0];
			Y0 = ypoints[i-1][1];
			X1 = ypoints[i][0];
			Y1 = ypoints[i][1];

			ctx.fillStyle = "black";
			ctx.beginPath();
			ctx.moveTo(X0, Y0);
			ctx.lineTo(X1, Y1);
			ctx.stroke(); 
		}
	}

	function matchPoints(){
		var xValue = 0;
		var yValue = 1;

		//creating a 2d array to hold the matching and distances
		var distances = [];
		var matches = [];	//will be filled with 0's, 0 = unmatched
		
		for (var i = 0; i < xpoints.length; i++){
			distances.push([]);
			matches.push([]);
        	
        	for (var j = 0; j < ypoints.length; j++){

				distances[i][j] = computeDistance(xpoints[i][xValue], xpoints[i][yValue], 
				ypoints[j][xValue], ypoints[j][yValue]);
				
				matches[i].push(0);
        	}
		} 	

		//matching each point

		//for every point in line x
		for(var i = 0; i < xpoints.length-1; i++){
			for(var j = 0; j < ypoints.length-1; j++){
				//if the distance between xpoints[i] and ypoints[i] <= xpoints[i] and ypoints[j+1], then match them
				var min = Math.min(distances[i][j], distances[i+1][j], distances[i][j+1], distances[i+1][j+1]);
				
				if(min == distances[i][j]){
					matches[i][j] = 1; //match between x[i] and y[j]

				}else if(min == distances[i+1][j]){
					matches[i+1][j] = 1;

				}else if(min == distances[i][j+1]){
					matches[i][j+1] = 1;

				}else if(min == distances[i+1][j+1]){
					matches[i+1][j+1] = 1;
				}

			}
		}	

		//making sure the first and last two point sets match
		matches[0][0] = 1;
		matches[xpoints.length-1][ypoints.length-1] = 1;

		//now draw the line segments for these matches!!
		drawMatches(matches);
	}

	function computeDistance(x1, y1, x2, y2){
		//calculate the distance between the two points using euclidean distance
		//||d|| = √( (x1 – y1)^2 + (x2 - y2)^2 )
		var distance = Math.sqrt( Math.pow( (x1 - x2), 2) + Math.pow( (y1 - y2), 2) );

		return distance;
	}

	function drawMatches(matchList){
		for(var i = 0; i < matchList.length; i++){
			for(var j = 0; j <matchList[i].length; j++){
				
				if(matchList[i][j] == 1){
					X0 = xpoints[i][0];
					Y0 = xpoints[i][1];
					X1 = ypoints[j][0];
					Y1 = ypoints[j][1];

					//drawing the line
					ctx.fillStyle = "green";

					ctx.beginPath();
					ctx.moveTo(X0, Y0);
					ctx.lineTo(X1, Y1);
					ctx.stroke();
				}
			}
		}

		

	}

	function selectPoint(evt) {
		let mousePos = getMousePos(canvas, evt);
		const X = mousePos.X;
		const Y = mousePos.Y
		let clickType = "LEFT";
		evt.preventDefault();
		if (evt.which) {
			if (evt.which == 3) clickType = "RIGHT";
			if (evt.which == 2) clickType = "MIDDLE";
		}
		else if (evt.button) {
			if (evt.button == 2) clickType = "RIGHT";
			if (evt.button == 4) clickType = "MIDDLE";
		}

		if (clickType == "LEFT") {
            if (selectingX) {
                xpoints.push([X, Y]);
            }
			else {
                ypoints.push([X, Y]);
            }
		}
		else if(clickType == "RIGHT") {
            if (selectingX) {
                xpoints.pop();
            }
            else {
                ypoints.pop();
            }
		}

		repaint();
	}


	canvas.addEventListener("mousedown", selectPoint);
	canvas.addEventListener("touchstart", selectPoint); //Works on mobile devices!
</script>


</body>
</html>