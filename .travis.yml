language: python

matrix:
  include:
    - python: 3.6
    - python: 3.7
      dist: bionic
      sudo: true
    - env: DISTRIB="conda" PYTHON_VERSION="3.6"
    - env: DISTRIB="conda" PYTHON_VERSION="3.7"
    - os: osx
      language: generic
      env: DISTRIB="conda" PYTHON_VERSION="3.6"
    - os: osx
      language: generic
      env: DISTRIB="conda" PYTHON_VERSION="3.7"
    - os: osx
      language: generic
      env: PYTHON_VERSION="3.6"
    - os: osx
      language: generic
      env: PYTHON_VERSION="3.7"

before_install:
    # 避免 matplotlib 关于 X11 的错误的技巧：
    # '没有显示名称和没有 $DISPLAY 环境变量'

    # 启用 GUI，参见 https://docs.travis-ci.com/user/gui-and-headless-browsers
    - if [ "$TRAVIS_OS_NAME" == "linux" ]; then
            export DISPLAY=:99.0;
            sh -e /etc/init.d/xvfb start;
            sleep 3;
      fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew list python &>/dev/null || brew install python; fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew list python3 &>/dev/null || brew install python3; fi
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew install pyenv-virtualenv; fi

services:
  - xvfb

install: source ci_scripts/install.sh

# 安装 matplotlib 是一个漫长的过程。使用缓存可以
# 通过大幅减少安装时间来加快测试速度。
cache:
    directories:
        # pip 的缓存，主要是为了加快 matplotlib 的安装
        - $HOME/.cache/pip

script:
  - pytest --cov linmdtw

# 上传代码覆盖率报告
after_success:
  - bash <(curl -s https://codecov.io/bash)

